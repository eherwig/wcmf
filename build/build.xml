<project name="wCMF" default="package" basedir=".">
  <description>wCMF build file</description>

  <property file="build.properties"/>

  <target name="init">
    <tstamp/>
  </target>

  <target name="buildinfo" depends="init"
    description="generate the build version file" >
    <propertyfile file="${build.info}"
     comment="Build Information File - DO NOT MODIFY">
        <entry key="version"
         value="${version}"/>
        <entry key="build"
         type="int" default="0000"
         operation="+" pattern="0000"/>
    </propertyfile>
  </target>

  <target name="properties" description="define properties">
    <property file="${build.info}"/>
    <property name="build.base" value="../"/>
    <property name="package.file" value="${build.base}wcmf_${version}.${build}.zip"/>
  </target>

  <target name="dist" depends="buildinfo,properties"
    description="build the distribution" >
    <mkdir dir="${dist.dir}"/>
    <copy todir="${dist.dir}">
      <fileset dir="${build.base}src/">
        <exclude name="**/*.log"/>
        <exclude name="**/log.txt"/>
        <exclude name="app/cache/**"/>
        <exclude name="app/config/*.ini"/>
        <exclude name="app/public/js/model/meta/_TypeList.js"/>
        <exclude name="app/public/js/model/types/**"/>
        <exclude name="app/public/vendor/**"/>
        <exclude name="app/public/media/**"/>
        <exclude name="app/public/export.xml"/>
        <exclude name="app/src/**"/>
        <exclude name="dist/**"/>
        <exclude name="install/*.sql"/>
        <exclude name="model/model-transformed/**"/>
        <exclude name="model/*.*"/>
        <exclude name="test/model/**"/>
        <exclude name="test/tests/**"/>
        <exclude name="test/tests/**"/>
        <exclude name="wcmf/changes.txt"/>
        <include name="**"/>
      </fileset>
    </copy>
    <copy todir="${dist.dir}/app/src">
      <fileset dir="${build.base}src/app/src/">
        <include name="model/EntityBase.php"/>
      </fileset>
    </copy>
    <copy todir="${dist.dir}/app/public/vendor">
      <fileset dir="${build.base}src/app/public/vendor/">
        <include name="dojo/dijit/**"/>
        <include name="dojo/dojo/**"/>
        <include name="dojo/dojox/**"/>
        <include name="dojo/util/*.*"/>
        <include name="dojo/util/buildscripts/*.*"/>
        <include name="dojo/util/build/**"/>
        <include name="dojo/util/closureCompiler/**"/>
        <include name="dojo/util/shrinksafe/**"/>
        <include name="ckeditor/**"/>
        <include name="ckeditor-plugins/**"/>
        <include name="dbootstrap/**"/>
        <include name="dgrid/**"/>
        <include name="dojomat/**"/>
        <include name="elfinder/**"/>
        <include name="font-awesome/**"/>
        <include name="put-selector/**"/>
        <include name="routed/**"/>
        <include name="twitter-bootstrap/**"/>
        <include name="xstyle/**"/>
        <exclude name="**/demos/**"/>
        <exclude name="**/samples/**"/>
        <exclude name="**/src/**"/>
        <exclude name="**/test/**"/>
        <exclude name="**/tests/**"/>
        <exclude name="**/.git*"/>
      </fileset>
    </copy>
    <mkdir dir="${dist.dir}/app/cache"/>
    <mkdir dir="${dist.dir}/app/public/js/model/types"/>
    <mkdir dir="${dist.dir}/app/public/media"/>
    <mkdir dir="${dist.dir}/app/src/model"/>
    <mkdir dir="${dist.dir}/app/src/views"/>
    <mkdir dir="${dist.dir}/app/src/controller"/>
    <mkdir dir="${dist.dir}/test/tests"/>
    <copy todir="${dist.dir}/model/" flatten="true">
      <fileset dir="${build.base}src/model/">
        <include name="base/cwm-export.uml"/>
        <include name="base/workflow.properties"/>
        <include name="chronos.profile.uml"/>
      </fileset>
    </copy>
    <copy file="${build.info}" todir="${dist.dir}"/>
  </target>

  <target name="package" depends="dist"
    description="pack the distribution" >
    <zip destfile="${package.file}" basedir="${dist.dir}"/>
    <delete dir="${dist.dir}"/>
  </target>

  <target name="clean" depends="properties"
    description="clean up" >
    <delete dir="${dist.dir}"/>
    <delete file="${package.file}"/>
  </target>
</project>