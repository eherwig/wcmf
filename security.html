<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>wCMF 4.0: Security</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A PHP framework for building reliable maintainable and extendable web applications">
    <meta name="keywords" content="PHP, web application framework, model driven development">
    <meta name="author" content="wemove digital solutions">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <link href="theme/css/doxstyles.css" rel="stylesheet">
    <script src="jquery.js"></script>
    <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
    <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
    <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
    <script src="theme/js/tocify/jquery.tocify.min.js"></script>
    <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
    <script src="theme/js/doxy-boot.js"></script>
    <script src="theme/js/application.js"></script>
    <script src="dynsections.js"></script>
    <link href="theme/css/syntax.css" rel="stylesheet">
    <link href="theme/css/style.css" rel="stylesheet">
    <script src="search/search.js"></script>
    <script src="search/searchdata.js"></script>
  </head>
  <body style="min-height: 200px; padding-top: 50px;">
    <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
      <div class="container">
        <div class="row">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
            <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
                <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">wCMF 4.0</a>
            </div>
            <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
              <ul class="nav navbar-nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="gettingstarted.html">Getting started</a></li>
                    <li><a href="architecture.html">Architecture</a></li>
                    <li><a href="model.html">Model</a></li>
                    <li><a href="persistence.html">Persistence</a></li>
                    <li><a href="presentation.html">Presentation</a></li>
                    <li><a href="configuration.html">Configuration</a></li>
                    <li><a href="security.html">Security</a></li>
                    <li><a href="i18n.html">I18N</a></li>
                    <li><a href="tests.html">Tests</a></li>
                  </ul>
                </li>
                <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
                <li><a href="https://github.com/iherwig/wcmf" target="_blank"><i class="fa fa-github"></i> Code</a></li>
                <li><a href="support.html"><i class="fa fa-support"></i> Support</a></li>
              </ul>
              <ul class="nav navbar-nav pull-right">
                <li>
                  <div id="MSearchBox">
                    <input id="MSearchField" type="text" class="form-control" placeholder="Search API" name="query" onkeyup="searchBox.OnSearchFieldChange(event)">
                  </div>
                  <div id="MSearchSelect"></div>
                  <div id="MSearchClose"></div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>
    <a class="anchor" id="top"></a>
    <div class="content" id="content">
      <div class="container">
        <div class="row" style="margin-top: 20px;">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
            <div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Security </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="sec_main"></a>
Security</h1>
<p>Two key aspects of securing an application are <em>authentication</em> and <em>authorization</em>. While <b>authentication</b> is the process of verifying the identity of a user, <b>authorization</b> means determining if the user is allowed to do what he or she is about to do. That implies that authentication is a precondition for authorization.</p>
<h2><a class="anchor" id="sec_users_roles"></a>
Users and Roles</h2>
<p>Users are essential for an authentication system. In wCMF users are represented as instances of classes implementing the <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1principal_1_1_user.html"><code>User</code></a> interface. Since wCMF's authorization system is role based, users are organized in roles. Role classes implement the <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1principal_1_1_role.html"><code>Role</code></a> interface.</p>
<h2><a class="anchor" id="sec_authentication"></a>
Authentication</h2>
<p>In wCMF authentication is handled by implementations of <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1_authentication_manager.html"><code>AuthenticationManager</code></a>.</p>
<p>Currently the framework provides <a class="el" href="classwcmf_1_1lib_1_1security_1_1impl_1_1_default_authentication_manager.html"><code>DefaultAuthenticationManager</code></a>, which implements a <b>login/password</b> based authentication procedure by matching the given user credentials against existing <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1principal_1_1_user.html"><code>User</code></a> instances. These instances are provided by implementations of <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1principal_1_1_principal_factory.html"><code>PrincipalFactory</code></a>.</p>
<p>The following code demonstrates the authentication process as implemented in <a class="el" href="classwcmf_1_1application_1_1controller_1_1_login_controller.html"><code>LoginController</code></a>:</p>
<div class="fragment"><div class="line"><span class="comment">// get the user credentials from the request</span></div>
<div class="line">$login = $request-&gt;getValue(<span class="stringliteral">&#39;user&#39;</span>);</div>
<div class="line">$password = $request-&gt;getValue(<span class="stringliteral">&#39;password&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">  <span class="comment">// try to login using the credentials</span></div>
<div class="line">  $authManager = ObjectFactory::getInstance(<span class="stringliteral">&#39;authenticationManager&#39;</span>);</div>
<div class="line">  $authUser = $authManager-&gt;login($login, $password);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// set the authenticated user in the session</span></div>
<div class="line">  $session = ObjectFactory::getInstance(<span class="stringliteral">&#39;session&#39;</span>);</div>
<div class="line">  $session-&gt;setAuthUser($authUser);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span> (<a class="code" href="namespace_exception.html">Exception</a> $ex) {</div>
<div class="line">  Log::error(<span class="stringliteral">&quot;Could not log in: &quot;</span>.$ex, __CLASS__);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The configuration of the authentication process in the default application looks like the following:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[AuthenticationManager]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;__class = wcmf\lib\security\impl\DefaultAuthenticationManager</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;principalFactory = $principalFactory</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;[PrincipalFactory]</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;__class = wcmf\lib\security\principal\impl\DefaultPrincipalFactory</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;userType = app.src.model.wcmf.User</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;roleType = app.src.model.wcmf.Role</div>
</div><!-- fragment --><p>Since <a class="el" href="classwcmf_1_1lib_1_1security_1_1principal_1_1impl_1_1_default_principal_factory.html"><code>DefaultPrincipalFactory</code></a> retrieves user instances from the storage, it needs to configured with the appropriate entity types. If required, the default user type may be replaced by custom implementations of <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1principal_1_1_user.html"><code>User</code></a>.</p>
<dl class="section note"><dt>Note</dt><dd>The authenticated user, that is associated with the current session is obtained using the <a class="el" href="interfacewcmf_1_1lib_1_1core_1_1_session.html#a687dba7af92a5d45f6363b17fe941ff7"><code>Session::getAuthUser</code></a> method.</dd></dl>
<h2><a class="anchor" id="sec_authorization"></a>
Authorization</h2>
<p>The purpose of authorization is controlling access to application resources, which could be controllers or entity instances. To establish <b>access control</b>, rules have to defined in the first place an enforced afterwards.</p>
<h3><a class="anchor" id="sec_perm"></a>
Permissions</h3>
<p>Access control rules are expressed as <em>permissions</em>. Permissions are either granted or denied to a role (see <a class="el" href="security.html#sec_users_roles">Users and Roles</a>). Subject of a permission in wCMF is a combination of a <em>resource</em>, a <em>context</em> and an <em>action</em> and the notation is the same as for action keys (see <a class="el" href="architecture.html#arch_actionkey">Action Key</a>), except that the <em>controller</em> value is an arbitrary resource.</p>
<p>If written as an equation, the left side of the permission is the action key, while the right side is the list of roles, that are involved. Each role has either a <em>+</em> or a <em>-</em> sign prepended, meaning the permission is granted to the role or denied. The following code shows the <b>format</b>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;resource?context?action = +allowedRole -deniedRole ...</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Permissions may be formed from any string values for <em>resource</em>, <em>context</em> and <em>action</em> as long as they can be written as action key. Roles that are not listed in the permission are denied per default.</dd></dl>
<p>Besides custom resources, wCMF supports the following <b>built-in resources</b>:</p>
<ul>
<li><b>Entity type</b> to restrict access on all instances of an entity type (e.g. <code>app.src.model.wcmf.User</code>)</li>
<li><b>Entity property</b> to restrict access on a certain property of an entity type (e.g. <code>app.src.model.wcmf.User.login</code>)</li>
<li><b>Entity instance</b> to restrict access on one entity instance (e.g. <code>app.src.model.wcmf.User:123</code>)</li>
<li><b>Entity instance propery</b> to restrict access on a certain property of one entity instance (e.g. <code>app.src.model.wcmf.User:123.login</code>)</li>
</ul>
<p>The actions for these resources are properties of <a class="el" href="classwcmf_1_1lib_1_1persistence_1_1_persistence_action.html"><code>PersistenceAction</code></a>, e.g. <a class="el" href="classwcmf_1_1lib_1_1persistence_1_1_persistence_action.html#add302975378da047de904daa059a332b"><code>PersistenceAction::READ</code></a>.</p>
<p>The following code shows some permission examples:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;; tester role is not allowed to update any authors except for the specified one</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;; tester role is not allowed to update any authors stage attribute</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;app.src.model.Author??update = -tester</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;app.src.model.Author:111??update = +tester</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;app.src.model.Author.stage??update = +administrators</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;; tester role is not allowed to update any publishers name except for the specified one</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;; tester role is not allowed to update any authors stage attribute</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;app.src.model.Publisher.name??update = -tester</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;app.src.model.Publisher:111.name??update = +tester</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;; tester role is not allowed to read any book name except for the specified one</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;app.src.model.Book??read = -tester</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;app.src.model.Book:111??read = +tester</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;; tester role is not allowed to read chapter 111 and due to inheritance also not chapter 222</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;app.src.model.Chapter:111??read = -tester +administrators</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;; custom permissions</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;customPermission??start = +tester</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;customPermission??stop = -tester</div>
</div><!-- fragment --><h4>Default policy</h4>
<p><span class="label label-danger">TODO</span></p>
<h4>Permission inheritance</h4>
<p><span class="label label-danger">TODO</span></p>
<h3><a class="anchor" id="sec_perm_check"></a>
Checking permissions</h3>
<p><span class="label label-danger">TODO</span> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2015 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Tue Jul 21 2015 01:08:00 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.9.1</small>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
