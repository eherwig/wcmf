<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>wCMF 4.0: Configuration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A PHP framework for building reliable maintainable and extendable web applications">
    <meta name="keywords" content="PHP, web application framework, model driven development">
    <meta name="author" content="wemove digital solutions">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <link href="theme/css/doxstyles.css" rel="stylesheet">
    <script src="theme/js/jquery/jquery-2.1.1.min.js"></script>
    <script src="theme/js/jquery/jquery-ui-1.11.1.custom.min.js"></script>
    <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
    <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
    <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
    <script src="theme/js/tocify/jquery.tocify.min.js"></script>
    <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
    <script src="theme/js/doxy-boot.js"></script>
    <script src="theme/js/application.js"></script>
    <script src="dynsections.js"></script>
    <link href="theme/css/syntax.css" rel="stylesheet">
    <link href="theme/css/style.css" rel="stylesheet">
    <script src="search/search.js"></script>
    <script src="search/searchdata.js"></script>
  </head>
  <body style="min-height: 200px; padding-top: 50px;">
    <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
      <div class="container">
        <div class="row">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
            <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
                <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">wCMF 4.0</a>
            </div>
            <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
              <ul class="nav navbar-nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="gettingstarted.html">Getting started</a></li>
                    <li><a href="architecture.html">Architecture</a></li>
                    <li><a href="model.html">Model</a></li>
                    <li><a href="persistence.html">Persistence</a></li>
                    <li><a href="presentation.html">Presentation</a></li>
                    <li><a href="configuration.html">Configuration</a></li>
                    <li><a href="permissions.html">Permissions</a></li>
                    <li><a href="i18n.html">I18N</a></li>
                  </ul>
                </li>
                <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
                <li><a href="https://github.com/iherwig/wcmf" target="_blank"><i class="fa fa-github"></i> Code</a></li>
                <li><a href="#"><i class="fa fa-support"></i> Support</a></li>
              </ul>
              <ul class="nav navbar-nav pull-right">
                <li>
                  <div id="MSearchBox">
                    <input id="MSearchField" type="text" class="form-control" placeholder="Search" name="query" onkeyup="searchBox.OnSearchFieldChange(event)">
                  </div>
                  <div id="MSearchSelect"></div>
                  <div id="MSearchClose"></div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>
    <a class="anchor" id="top"></a>
    <div class="content" id="content">
      <div class="container">
        <div class="row" style="margin-top: 20px;">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
            <div>
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="conf_main"></a>
Configuration</h1>
<p>Application configuration is handled by implementations of <a class="el" href="interfacewcmf_1_1lib_1_1config_1_1_configuration.html"><code>Configuration</code></a>. To use the configuration througout the application, an instance of the appropriate implementation is passed to <a class="el" href="classwcmf_1_1lib_1_1core_1_1_object_factory.html"><code>ObjectFactory</code></a>. This class provides <a class="el" href="configuration.html#conf_di">Dependency injection</a> and access to the configuration.</p>
<div class="fragment"><div class="line">$configPath = <span class="stringliteral">&#39;../config/&#39;</span>;</div>
<div class="line">$configFile = <span class="stringliteral">&#39;config.ini&#39;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// configure ObjectFactory</span></div>
<div class="line">$config = <span class="keyword">new</span> InifileConfiguration($configPath);</div>
<div class="line">$config-&gt;addConfiguration($configFile);</div>
<div class="line">ObjectFactory::configure($config);</div>
<div class="line"></div>
<div class="line"><span class="comment">// get a pre-configured instance</span></div>
<div class="line">$session = ObjectFactory::getInstance(<span class="stringliteral">&#39;session&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// get a configuration value</span></div>
<div class="line">$config = ObjectFactory::getConfigurationInstance();</div>
<div class="line">$tz = $config-&gt;getValue(<span class="stringliteral">&#39;timezone&#39;</span>, <span class="stringliteral">&#39;application&#39;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="conf_format"></a>
Configuration Format</h2>
<p>Currently wCMF provides an implementation for using the <a href="http://en.wikipedia.org/wiki/INI_file">INI file</a> format. <a class="el" href="classwcmf_1_1lib_1_1config_1_1impl_1_1_inifile_configuration.html"><code>InifileConfiguration</code></a> handles ini files that consist of <b>key-value pairs</b> that are grouped in <b>sections</b>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[SectionA]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;key1 = value1</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;key2 = value2</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;[SectionB]</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;key3 = value3</div>
</div><!-- fragment --><p>Additionally it defines <b>array values</b> (enclosed in curly braces) and <b>inclusion</b> of additional files. Included files are defined in the <code>include</code> key of the <code>Config</code> section. Keys in the current file override keys from included files.</p>
<p>The following example shows how to include an array of additional configuration files in order to separate concerns:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[Config]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;include = {server.ini, persistence.ini, presentation.ini, security.ini}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>While path values in the configuration are normally resolved relative to the value of the <code>WCMF_BASE</code> constant, the included files are expected to be located in the directory that is passed to the constructor of <a class="el" href="classwcmf_1_1lib_1_1config_1_1impl_1_1_inifile_configuration.html"><code>InifileConfiguration</code></a>.</dd></dl>
<h2><a class="anchor" id="conf_di"></a>
Dependency injection</h2>
<p>wCMF supports <a href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency injection</a> through the <a class="el" href="classwcmf_1_1lib_1_1core_1_1_object_factory.html"><code>ObjectFactory</code></a> class. This class implements <em>setter injection</em>, which means that dependencies are either set through a <em>setter method</em> of the client class or a <em>public member variable</em>.</p>
<p>Assembly details for client instances are defined in the application configuration in special sections containing a <code>__class</code> key. The value of the key denotes the class to be used to create the client instance. All other keys are mapped to setters/members of that class. Complex dependencies of an instance may be set by using the <code>$</code> notation, which refers to another configuration section. If a section does not contain a <code>__class</code> key it is instantiated as an associative array.</p>
<p>The following example demonstrates the pattern by means of the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_facade.html"><code>PersistenceFacade</code></a> instance:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[PersistenceFacade]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;__class = wcmf\lib\persistence\impl\DefaultPersistenceFacade</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;mappers = $typeMapping</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;logging = false</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;logStrategy = $auditingLogStragegy</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;[AuditingLogStragegy]</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;__class = wcmf\lib\persistence\output\impl\AuditingOutputStrategy</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;[TypeMapping]</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;app.src.model.wcmf.DBSequence = $app_src_model_wcmf_DBSequenceRDBMapper</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;app.src.model.wcmf.Lock = $app_src_model_wcmf_LockRDBMapper</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;[app_src_model_wcmf_DBSequenceRDBMapper]</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;__class = app\src\model\wcmf\DBSequenceRDBMapper</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;connectionParams = $database</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;[app_src_model_wcmf_LockRDBMapper]</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;__class = app\src\model\wcmf\LockRDBMapper</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;connectionParams = $database</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;[Database]</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;dbType = sqlite</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;dbHostName = 127.0.0.1</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;dbName = app/test-db.sq3</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;dbUserName =</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;dbPassword =</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;dbCharSet = utf8</div>
</div><!-- fragment --><p>The first section defines that the instance named <code>PersistenceFacade</code> is an object of the class <a class="el" href="classwcmf_1_1lib_1_1persistence_1_1impl_1_1_default_persistence_facade.html"><code>DefaultPersistenceFacade</code></a>. The <em>logging</em> property is set to <em>false</em>, the <em>logStrategy</em> property is set to an instance of <a class="el" href="classwcmf_1_1lib_1_1persistence_1_1output_1_1impl_1_1_auditing_output_strategy.html"><code>AuditingOutputStrategy</code></a>. The <em>TypeMapping</em> section does not contain a <code>__class</code> key, which means that the <em>mappers</em> property of <code>PersistenceFacade</code> will be an associative array. In our case it maps class names (e.g. <em>app.src.model.wcmf.DBSequence</em>) to mapper instances (e.g. <code>DBSequenceRDBMapper</code>). Further sections show that the <em>connectionParams</em> property of the <code>DBSequenceRDBMapper</code> instance is set to an associative array describing the database connection (section <em>Database</em>).</p>
<dl class="section note"><dt>Note</dt><dd>Configuration section and key names are treated case-insensitive.</dd></dl>
<p>The <code>PersistenceFacade</code> instance may be retrieved later by using the following code:</p>
<div class="fragment"><div class="line">$persistenceFacade = ObjectFactory::getInstance(<span class="stringliteral">&#39;persistenceFacade&#39;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="conf_shareddi"></a>
Shared and Non-Shared instances</h3>
<p>By default all instances created by <a class="el" href="classwcmf_1_1lib_1_1core_1_1_object_factory.html"><code>ObjectFactory</code></a> are <em>shared</em> instances, which means, that they will be created on the first call and only returned by succeeding calls. If you want to create a <em>non-shared</em> instance, you must use the <code>__shared</code> key in configuration and set it to <em>false</em>.</p>
<p>The following example shows the configuration of a non-shared <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1view_1_1_view.html"><code>View</code></a> instance:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[View]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;__class = wcmf\lib\presentation\view\impl\SmartyView</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;__shared = false</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;compileCheck = true</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;caching = false</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;cacheLifetime = 3600</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;cacheDir = app/cache/smarty/</div>
</div><!-- fragment --><h2><a class="anchor" id="conf_peruser"></a>
Configuration for individual users</h2>
<p>wCMF's user base class <a class="el" href="classwcmf_1_1lib_1_1security_1_1principal_1_1impl_1_1_abstract_user.html"><code>AbstractUser</code></a> has a persistent property <code>config</code> which may be used to set a individual configuration for a user. This will be loaded after the standard configuration and extends its settings. If two keys have the same name the one from the user configuration overwrites the standard one. Using the <em>RoleConfig</em> configuration section, you can easily assign configuration files to groups:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[RoleConfig]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;administrators = admin.ini</div>
</div><!-- fragment --><p>If a user is added to a listed role, the given configuration file will be automatically assigned to it, if no individual configuration is set yet.</p>
<h2><a class="anchor" id="conf_default"></a>
Default configuration files</h2>
<p>The following sections describe the configuration files that are created from the default application's model.</p>
<h3><a class="anchor" id="conf_config_ini"></a>
config.ini</h3>
<p><span class="label label-danger">TODO</span></p>
<h3><a class="anchor" id="conf_permissions_ini"></a>
permissions.ini</h3>
<p><span class="label label-danger">TODO</span></p>
<h3><a class="anchor" id="conf_presentation_ini"></a>
presentation.ini</h3>
<p><span class="label label-danger">TODO</span></p>
<h3><a class="anchor" id="conf_security_ini"></a>
security.ini</h3>
<p><span class="label label-danger">TODO</span></p>
<h3><a class="anchor" id="conf_server_ini"></a>
server.ini</h3>
<p><span class="label label-danger">TODO</span></p>
<h2><a class="anchor" id="conf_logging"></a>
Logging configuration</h2>
<p><span class="label label-danger">TODO</span> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2015 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Mon Mar 2 2015 23:31:12 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.9.1</small>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
