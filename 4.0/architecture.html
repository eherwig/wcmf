<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>wCMF 4.0: Architecture</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    <link href="theme/css/doxstyles.css" rel="stylesheet">
    <script src="theme/js/jquery/jquery-2.1.1.min.js"></script>
    <script src="theme/js/jquery/jquery-ui-1.11.1.custom.min.js"></script>
    <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
    <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
    <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
    <script src="theme/js/tocify/jquery.tocify.min.js"></script>
    <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
    <script src="theme/js/doxy-boot.js"></script>
    <script src="theme/js/application.js"></script>
    <script src="dynsections.js"></script>
    <link href="theme/css/syntax.css" rel="stylesheet">
    <link href="theme/css/style.css" rel="stylesheet">
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="wCMF"/>
  </head>
  <body style="min-height: 200px; padding-top: 50px;">
    <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
      <div class="container">
        <div class="row">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
            <div class="navbar-header">
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
                <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">wCMF 4.0</a>
            </div>
            <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
              <ul class="nav navbar-nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="gettingstarted.html">Getting started</a></li>
                    <li><a href="architecture.html">Architecture</a></li>
                    <li><a href="#">Modeling</a></li>
                    <li><a href="howtos.html">Persistence</a></li>
                    <li><a href="#">Controllers</a></li>
                    <li><a href="configuration.html">Configuration</a></li>
                    <li><a href="extensionpoints.html">Permissions</a></li>
                    <li><a href="#">I18N</a></li>
                  </ul>
                </li>
                <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
                <li><a href="https://github.com/iherwig/wcmf" target="_blank"><i class="fa fa-github"></i> Code</a></li>
              </ul>
              <ul class="nav navbar-nav pull-right">
                <form class="navbar-form navbar-left" role="search" method="get" action="search.php">
                  <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" name="query">
                  </div>
                  <button type="submit" class="btn btn-default">Submit</button>
                </form>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>
    <a class="anchor" id="top"></a>
    <div class="content" id="content">
      <div class="container">
        <div class="row" style="margin-top: 20px;">
          <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
            <div>
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="secarchitecture"></a>
Architecture</h1>
<dl class="section note"><dt>Note</dt><dd>Method/class names in diagrams may vary from the current ones found in the framework.</dd></dl>
<h2><a class="anchor" id="persistence"></a>
Data storage</h2>
<p>The main task of the framework is to provide an easy-to-use interface to different (not object oriented) persistence mechanisms (whether they're relational databases or XML files).</p>
<p>For this purpose the framework defines the PersistentObject class, which provides operations for changing, saving and deleting data. This class and its subclasses are the data's object oriented representation (<em>domain</em> <em>classes</em> or <em>content</em> <em>types</em> in an CMS context), which is used by application developers. The transformation into relational presentations is carried out by specialized subclasses of PersistenceMapper, which for instance implement the appropriate SQL commands. The domain objects (instances of the domain classes) use these classes transparently to the programmer.<br />
PersistenceMapper classes make use of the DataConverter classes in order to convert data between application and persistent storage. In this way for instance the date format of the database can be converted to the preferred format of the application.<br />
If a direct access to the persistence layer is necessary - for example when loading objects - the PersistenceFacade is used, which delegates the request to the appropriate mapper.<br />
For relational database storages wCMF uses the <a href="http://adodb.sourceforge.net/" target="_blank">ADOdb</a> Database Library for PHP as abstraction layer.</p>
<div class="image">
<img src="persistence.png" alt="persistence.png"/>
<div class="caption">
Persistence Classes</div></div>
<h2><a class="anchor" id="datarepresentation"></a>
Data representation</h2>
<p>At present the framework defines two specialized domain classes, Node and Table, of which the Node class is the application development's central component. Since data is predominantly organized hierarchical, this class provides a generic data container, which allows for the building of tree structures. Node objects can contain different attributes. This makes the definition of different domain classes possible (which merely differ in their attributes: <em>headline</em>, <em>text</em>, <em>image</em>, <em>link</em> etc. - not in their functionality). Appropriate mapper classes are NodeRDBMapper, NodeXMLDBMapper a.o.</p>
<p>The class NodeIterator is responsible for traversing trees composed of nodes. This class implements a depth-first algorithm (the traversing follows the structure to the deepest node first before it continues with the neighboring). Subclasses can implement further algorithms.<br />
The extension of node classes with additional operations follows the visitor pattern. Subclasses of Visitor for instance add behaviour like <em>save</em> (CommitVisitor), <em>graphical</em> <em>display</em> (LayoutVisitor) oder <em>output</em> (OutputVisitor).<br />
 </p>
<h3><a class="anchor" id="oid"></a>
Object Identifier</h3>
<p>For handling lots of different domain objects an unique identification is crucial. In order to achieve this, so-called <em>Object</em> <em>Identifier</em> (<em>OID</em>) are used. Various strategies are possible to obtain these identifiers</p><ul>
<li>for example a central registry. The wCMF composes these OIDs from the type (domain class or type of the PersistentObject) and a number, which is unique for each type. As an advantage this method prevents conflicts when domain objects are generated from different database tables and an 'autoincrement' attribute of these tables is used as the number. Important is, that the object's type can be derived from the OID, because this enables the PersistenceFacade to deduce the PersistenceMapper for the given object via the configuration file. The PersistenceFacade provides methods for composition and interpretation of the OIDs.</li>
</ul>
<div class="image">
<img src="domain_objects.png" alt="domain_objects.png"/>
<div class="caption">
Node class</div></div>
 <h2><a class="anchor" id="output"></a>
Data output</h2>
<p>The output format of the nodes (e.g. when using the OutputVisitor) is specified in the corresponding OutputStrategy. Examples are the XMLOutputStrategy for converting data to XML format for use in <em>Flash</em> movies for instance or further processing via XSLT, TreeViewOutputStrategy for creating HTML Treeviews or DotOutputStrategy for use with <em>dot</em>, which generates a graphic representation of the data.</p>
<div class="image">
<img src="data_output.png" alt="data_output.png"/>
<div class="caption">
Data output classes</div></div>
 <h2><a class="anchor" id="userinterface"></a>
User interface</h2>
<p>The user interface of a wCMF application is based on the <em>Model-View-Controller</em> (<em>MVC</em>) pattern. According to this pattern the application instanciates a specific controller for each action, which loads the data (model) required for that action and - where applicable - presents the data to the user via the corresponding view. Upon execution of a controller the next action will be determined. This could either depend on the result of the action (<em>successful</em>, <em>failed</em> etc.) or explicitly be specified by the user (<em>save</em>, <em>delete</em> etc.). The application flow is defined by stringing together controller-action pairs.</p>
<p>The ActionMapper - configured via a configuration file (see <a class="el" href="configuration.html">Configuration</a>) - controls the application flow. It creates <em>controller</em> objekts, which execute actions like <em>save</em> changes, <em>add</em> elements, <em>delete</em> elements or <em>display</em> data - where applicable - with the help of views. For execution the Controller baseclass defines an algorithm, which is implemented by specialized subclasses.<br />
The <em>model</em>, which the controllers work with, is constituted of the domain classes - in most cases a tree structure of Node objects.<br />
The framework uses the <a href="http://smarty.php.net/" target="_blank">Smarty</a> Template Engine to create the <em>views</em>. This means, that a view is defined by a <em>Smarty</em> template (*.tpl file), which is displayed by an instance of the class View. Before the data is displayed the controller extracts it from the model and assigns it to the view instance.</p>
<div class="image">
<img src="mvc.png" alt="mvc.png"/>
<div class="caption">
MVC Classes</div></div>
 <h2><a class="anchor" id="accesscontrol"></a>
Access control</h2>
<p>Permissions for controller(|domain class|OID)-context-action triplets (see <a class="el" href="configuration.html">Configuration</a>) are configured based on roles (defined in the data storage). Several users can be assigned to one role and each user can be assigned to different roles. The assignment of rights is made in the configuration file. Here permissions can be explicitly granted or denied. During the application flow authentification/ authorization is accomplished by the RightsManager together with a representation of the current user (as an instance of the AuthUser class, which is created upon successful login and added to the session data).</p>
<h2><a class="anchor" id="applicationflow"></a>
Application flow</h2>
<p>To run the wCMF in a web browser a PHP script is necessary as entry point. This is similar to a <em>main</em> method, which instanciates the initial application objects and hands the control over to these objects.</p>
<p>In our case this script is <em>main.php</em>. It receives parameters (<em>controller</em>, <em>context</em>, <em>action</em>, <em>data</em>) over a HTTP request. These parameters could for instance origin from the previous view. They are made available to the ActionMapper in form of an Request instance using the method ActionMapper::processAction. The ActionMapper then takes over the control of the application flow and returns after finishing its task or displaying a view, respectively. Display of a view always interrupts the application's flow and allows the user to interact. The view sends the data obtained during the interaction (e.g. form data) as HTTP Request back to the script <em>main.php</em>.<br />
 For each call of the method ActionMapper::processAction the ActionMapper on his part instanciates an appropriate controller object, which is supplied with data by Controller::initialize and executed by Controller::execute. The Controller baseclass provides in its method <em>execute</em> the algorithm for validating the data - and if applicable - initializing the view. Concrete controller classes execute their specific tasks in the method Controller::executeKernel. If no view is assigned to a controller, the <em>execute</em> method returns <em>true</em>. The execution result is stored in the Response instance, which again is converted into a Request instance and passed to the next call of the ActionMapper's <em>processAction</em> method. Thus it's possible to cascade different controllers to compose complex tasks out of several simple. Otherwise the controller assigns the model to the view, which is then displayed by the view with its template (here <em>view.tpl</em>).</p>
<p>Request and Response instances are interpreted using IFormat implementations. This allows the framework to realise different formats for sending and receiving data. Known formats are HTML, JSON and SOAP.</p>
<p>The configuration of the controllers, views and actions is done in the configuration file (see <a class="el" href="configuration.html">Configuration</a>).</p>
<div class="image">
<img src="mvc_sequence.png" alt="mvc_sequence.png"/>
<div class="caption">
Application flow</div></div>
 </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <p>&copy; 2014 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Tue Aug 26 2014 02:48:59 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.7</p>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
