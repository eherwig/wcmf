<project name="wCMF" default="dist" basedir=".">
	<description>
		wCMf build file
	</description>

	<property file="build.properties"/>
        <property name="app.name"
                  location="../"
                  relative="true"
                  basedir="../../"/>

	<target name="init">
		<tstamp/>
	</target>

	<target name="buildinfo" depends="init"
		description="generate the build version file" >
		<propertyfile file="${build.info}"
		 comment="Build Information File - DO NOT MODIFY">
		    <entry key="version"
		     value="${version}"/>
		    <entry key="build"
		     type="int" default="0000"
		     operation="+" pattern="0000"/>
		</propertyfile>
	    <property file="${build.info}"/>
	</target>

	<target name="compile" depends="buildinfo"
		description="build the frontend" >
		<exec dir="${dojo.build.base}" executable="${dojo.build.script}" output="dojobuild.log">
			<arg line="profile=${dojo.build.profile}"/>
		</exec>
	</target>

	<target name="dist" depends="compile"
		description="build the distribution" >
		<mkdir dir="${dist.dir}"/>
		<copy todir="${dist.dir}/wcmf">
			<fileset dir="../../wcmf/">
				<exclude name="tools/"/>
				<include name="**"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}/${app.name}">
			<fileset dir="../">
				<exclude name="public/"/>
				<exclude name="release/"/>
				<exclude name="_build/"/>
				<exclude name="_install/"/>
				<include name="**"/>
			</fileset>
		</copy>
		<copy todir="${dist.dir}/${app.name}/public">
			<fileset dir="../release">
				<exclude name="js/"/>
				<exclude name="vendor/"/>
				<exclude name="build-report.txt"/>
				<exclude name="**/*.js.map"/>
				<exclude name="**/*.js.uncompressed.js"/>
				<include name="**"/>
			</fileset>
			<fileset dir="../release">
				<include name="js/App.js"/>
				<include name="js/App.js.map"/>
				<include name="js/App.js.uncompressed.js"/>
				<include name="**/nls/**/*.*"/>
				<include name="vendor/dojo/dojo/dojo.js"/>
				<include name="vendor/dojo/dojo/dojo.js.map"/>
				<include name="vendor/dojo/dojo/dojo.js.uncompressed.js"/>
				<include name="vendor/dbootstrap/theme/dbootstrap/font/*.*"/>
			</fileset>
		</copy>
		<copy file="${build.info}" todir="${dist.dir}"/>
		<!--delete dir="../release"/-->
	</target>

	<target name="package" depends="dist"
                description="pack the distribution" >
		<zip destfile="${app.name}_${version}.zip" basedir="${dist.dir}"/>
	</target>

	<target name="clean"
		description="clean up" >
		<delete dir="${build.dir}"/>
		<delete dir="${dist.dir}"/>
	</target>
</project>